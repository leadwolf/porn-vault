## Config

> Some parameters that are essential to the program are defined via environment variables. [See here](https://github.com/porn-vault/porn-vault/blob/dev/doc/env.md) 

If the program cannot find a config file, the program will go through an interactive setup, and then create a config file for you.

> Note: not all settings will be prompted to the user, the rest will automatically taken from defaults, [that you can find here](https://github.com/porn-vault/porn-vault/blob/dev/config.example.json).

### Config location

The config file must be located in the folder defined by the environment variable `PV_CONFIG_FOLDER` (usually the same folder as the program), and can either be JSON or YAML. It must be named `config.json` or `config.yaml`. If both files exist, the program will use JSON over YAML.

### Adjusting the config

A base config file [can be found here](https://github.com/porn-vault/porn-vault/blob/dev/config.example.json). It's used for Docker containers, but you can copy the file even if you are not using Docker.
You just need to adjust the values for `binaries.ffmpeg` and `binaries.ffprobe`, as those depend on your setup. Here's how they should look:

```json
{
  "binaries": {
    "ffmpeg": "path/to/your/ffmpeg",
    "ffprobe": "path/to/your/ffprobe"
  }
}
```

If you do not have FFMPEG, download them manually or start the program without a config: when starting the program **without** a config, the program will ask you if it should download these binaries and will automatically set the paths if it does.

### Config guide

| Key                                        | [Default](https://github.com/porn-vault/porn-vault/blob/dev/src/config/default.ts) | Description                                                                                                                                                                                                                                                              |
|--------------------------------------------|------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `search.host`                              | `http://localhost:9200`                                                            | Elasticsearch host URL                                                                                                                                                                                                                                                   |
| `search.version`                           | `7.x`                                                                              | Elasticsearch version                                                                                                                                                                                                                                                    |
| `search.log`                               | `false`                                                                            | Enable Elasticsearch trace logging (debug). Logs all requests & responses that porn-vault makes to Elasticsearch                                                                                                                                                         |
| `search.auth`                              | `null`                                                                             | Elastichsearch auth string                                                                                                                                                                                                                                               |
| `binaries.ffmpeg`                          | (empty)                                                                            | Where the ffmpeg binary is located; will be placed in working directory when downloading using the interactive setup                                                                                                                                                     |
| `binaries.ffprobe`                         | (empty)                                                                            | Where the ffprobe binary is located; will be placed in working directory when downloading using the interactive setup                                                                                                                                                    |
| `binaries.izzyPort`                        | 8000                                                                               | Which port Izzy (database) should run on                                                                                                                                                                                                                                 |
| `import.images`                            | (empty)                                                                            | Paths of image files that will be imported - subfolders will be searched recursively                                                                                                                                                                                     |
| `import.videos`                            | (empty)                                                                            | Paths of video files that will be imported - subfolders will be searched recursively                                                                                                                                                                                     |
| `log.level`                                | `"info"`                                                                           | Level of messages to log to the console. [See dedicated docs here](https://github.com/porn-vault/porn-vault/blob/dev/doc/logging.md)                                                                                                                                     |
| `log.maxSize`                              | `"20m"`                                                                            | Max. size for a single log file. This can be a number of bytes, or units of kb, mb, and gb. If using the units, add 'k', 'm', or 'g' as the suffix. The units need to directly follow the number                                                                         |
| `log.maxFiles`                             | `"5"`                                                                              | Max. amount of log files to store, for a single `writeFile` configuration. This can be a number of files or number of days. If using days, add 'd' as the suffix.                                                                                                        |
| `log.writeFile`                            | `see example`                                                                      | Array of log file configurations                                                                                                                                                                                                                                         |
| `log.writeFile[0].level`                   | `"error"`                                                                          | Level of messages to write to this file                                                                                                                                                                                                                                  |
| `log.writeFile[0].prefix`                  | `"errors-"`                                                                        | Prefix to apply to the log file                                                                                                                                                                                                                                          |
| `log.writeFile[0].silent`                  | `false`                                                                            | Quick flag to disable this file configuration so you don't have to remove/add the whole configuration                                                                                                                                                                    |
| `matching.applySceneLabels`                | `true`                                                                             | When a scene plugin is run, if the scene labels should be added to images created by the plugin.  [See dedicated docs here](https://github.com/porn-vault/porn-vault/blob/dev/doc/apply_labels.md#scenes)                                                                |
| `matching.applyActorLabels`                | `see example`                                                                      | The events where actor labels should be applied to scenes, images & plugin images the actor is starring in. [See dedicated docs here](https://github.com/porn-vault/porn-vault/blob/dev/doc/apply_labels.md#actors)                                                      |
| `matching.applyStudioLabels`               | `see example`                                                                      | Same as `matching.applyActorLabels`, but for studios, if their labels should be added to scenes of the studio & images created by plugins.  [See dedicated docs here](https://github.com/porn-vault/porn-vault/blob/dev/doc/apply_labels.md#studios)                     |
| `matching.extractSceneActorsFromFilepath`  | `true`                                                                             | When a scene is imported (created), if existing actors should be matched to the scene's filepath and added to the scene                                                                                                                                                  |
| `matching.extractSceneLabelsFromFilepath`  | `true`                                                                             | Same as `matching.extractSceneActorsFromFilepath`, but for labels                                                                                                                                                                                                        |
| `matching.extractSceneMoviesFromFilepath`  | `true`                                                                             | Same as `matching.extractSceneActorsFromFilepath`, but for movies                                                                                                                                                                                                        |
| `matching.extractSceneStudiosFromFilepath` | `true`                                                                             | Same as `matching.extractSceneActorsFromFilepath`, but for studios                                                                                                                                                                                                       |
| `matching.matchCreatedActors`              | `true`                                                                             | When an actor is created, if it should automatically be matched and added to existing scenes                                                                                                                                                                             |
| `matching.matchCreatedStudios`             | `true`                                                                             | Same as `matching.matchCreatedActors`, but for studios                                                                                                                                                                                                                   |
| `matching.matchCreatedLabels`              | `true`                                                                             | Same as `matching.matchCreatedActors`, but for labels                                                                                                                                                                                                                    |
| `matching.matcher.type`                    | `"word"`                                                                           | How strings should be matched when extracting actors, labels... from file paths                                                                                                                                                                                          |
| `matching.matcher.options`                 | `!see doc!`                                                                        | Options for the matcher. Each matcher has different options. [See here for available options](https://github.com/porn-vault/porn-vault/blob/dev/doc/matcher.md)                                                                                                          |
| `persistence.backup.enable`                | `true`                                                                             | Whether to create a backup when starting the server                                                                                                                                                                                                                      |
| `persistence.backup.maxAmount`             | 10                                                                                 | Max amount of backups in backups/ folder. Oldest one will be deleted, if max amount has been reached.                                                                                                                                                                    |
| `persistence.libraryPath`                  | Current Working Directory                                                          | Path where the library (.db files & uploaded files & processed images) will be stored                                                                                                                                                                                    |
| `plugins.allowActorThumbnailOverwrite`     | `false`                                                                            | Allow plugins to overwrite actor images                                                                                                                                                                                                                                  |
| `plugins.allowMovieThumbnailOverwrite`     | `false`                                                                            | Allow plugins to overwrite movie images                                                                                                                                                                                                                                  |
| `plugins.allowSceneThumbnailOverwrite`     | `false`                                                                            | Allow plugins to overwrite scene thumbnail                                                                                                                                                                                                                               |
| `plugins.allowStudioThumbnailOverwrite`    | `false`                                                                            | Allow plugins to overwrite studio thumbnail                                                                                                                                                                                                                              |
| `plugins.createMissingActors`              | `false`                                                                            | Create actors returned from plugins when not found in library                                                                                                                                                                                                            |
| `plugins.createMissingLabels`              | `false`                                                                            | Create labels returned from plugins when not found in library                                                                                                                                                                                                            |
| `plugins.createMissingMovies`              | `false`                                                                            | Create movies returned from plugins when not found in library                                                                                                                                                                                                            |
| `plugins.createMissingStudios`             | `false`                                                                            | Create studio returned from plugins when not found in library                                                                                                                                                                                                            |
| `plugins.markerDeduplicationThreshold`     | `5`                                                                                | Threshold (in seconds) in which new markers will be ignored                                                                                                                                                                                                              |
| `plugins.register`                         | (empty)                                                                            | Define plugins and their own configuration. See https://github.com/porn-vault/porn-vault/blob/dev/doc/plugins_intro.md#register-plugin                                                                                                                                   |
| `plugins.events`                           | (empty)                                                                            | Which plugins to run for which events. The names of the plugins are the names defined in `plugins.register`. See https://github.com/porn-vault/porn-vault/blob/dev/doc/plugins_intro.md#register-plugin                                                                  |
| `processing.doProcessing`                  | `true`                                                                             | Whether queued scenes should be processed                                                                                                                                                                                                                                |
| `processing.generatePreviews`              | `true`                                                                             | Whether video preview should be generated from imported videos (used in video player seek bar)                                                                                                                                                                           |
| `processing.generateScreenshots`           | `true`                                                                             | Whether thumbnails should be extracted from imported videos                                                                                                                                                                                                              |
| `processing.generateImageThumbnails`       | `true`                                                                             | Whether thumbnails should be generated for every image created. Uses approximately 1 GB per 10k images. Reduces disk usage, and internet bandwidth when looking at images. Original, full size images will still be shown when clicking on an image to view its details. |
| `processing.imageCompressionSize`          | `720`                                                                              | Max. image width to compress thumbnails etc to                                                                                                                                                                                                                           |
| `processing.readImagesOnImport`            | `false`                                                                            | Read image dimensions/hash on import, will greatly increase import time for a big image library (10000+)                                                                                                                                                                 |
| `processing.screenshotInterval`            | 120                                                                                | Seconds between thumbnail snapshots in seconds                                                                                                                                                                                                                           |
| `scan.excludeFiles`                        | (empty)                                                                            | Array of regular expressions that, if any of them match a file name, will cause the file to be ignored                                                                                                                                                                   |
| `scan.interval`                            | 108000000 (3 hours)                                                                | Rescan paths all X milliseconds - only works when `scan.scanOnStartup` is enabled                                                                                                                                                                                        |
| `scan.scanOnStartup`                       | `false`                                                                            | Whether video and image paths should be scanned                                                                                                                                                                                                                          |
| `server.https.enable`                      | `false`                                                                            | Enable https instead of http                                                                                                                                                                                                                                             |
| `server.https.key`                         | (empty)                                                                            | Path to the ssl key file used if `server.https.enable` is activated                                                                                                                                                                                                      |
| `server.https.certificate`                 | (empty)                                                                            | Path to the ssl cert file used if `server.https.enable` is activated                                                                                                                                                                                                     |
| `server.port`                              | 3000                                                                               | Port server is running on                                                                                                                                                                                                                                                |
| `transcode.webm`                              |                                                                                | Configuration for webm transcodes                                                                                                                                                                                                                                                |
| `transcode.webm.deadline`                              | `realtime`                                                                               | Efficiency of compression. Possible values are `realtime`, `good`, `best`                                                                                                                                                                                                                                                |
| `transcode.webm.cpuUsed`                              | 5                                                                               | Cpu utilisation. Set a value from 0-3. Higher value increases encode speed at expense of quality                                                                                                                                                                                                                                                |
| `transcode.webm.crf`                              | 31                                                                               | Constant rate factor. Set a value from 0-64. Lower is better quality                                                                                                                                                                                                                                                |
